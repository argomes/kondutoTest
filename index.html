<!DOCTYPE html PUBLIC"-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">

	<title>TESTE KONDUTO</title>

</head>

<body>
	<div class="container-fluid">
		<div class="row">
	        <div class="span6" style="float: none; margin: 40px auto;">
	           		<div class="card" style="width: 30rem;">
					  <div class="card-body">
					  	<h5 class="card-title">Send Sales Test Konduto</h5>
					  	<form id="formId">
						  <div class="form-row">
							<div class="col-md-12 mb-3">
								<input class="form-control" type="text" id="authorization" required="true" placeholder="Authorization" />
							</div>
							<div class="col-md-12 mb-3">
								<input class="form-control" type="text" id="orderId" required="true" placeholder="Order Id" />
							</div>
							<div class="col-md-12 mb-3">
								<input class="form-control" type="number" id="amount" required="true" placeholder="Amount" />
							</div>
							
						  </div>
						  	<div class="footer">
									<button type="submit" id="sendSales" class="btn btn-primary">Send Sales</button>
								
								</div>	
						</form>
					  	
					  </div>
					</div>
	        </div>
    	</div>

	</div>
	

</body>

	
	<script src="jquery-3.5.1.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>

	<script type="text/javascript">   
		var __kdt = __kdt || [];
		var customerID = "TESTE_LOCAL_ANDERSON_2003"; // define o ID do cliente 
		__kdt.push({"public_key": "TF8C11B700F"});   
		__kdt.push({"post_on_load": false});   // Envio automático desativado   
			(function() {   
				var kdt = document.createElement('script');   
				kdt.id = 'kdtjs'; kdt.type = 'text/javascript';   
				kdt.async = true;    
				kdt.src = 'https://i.k-analytix.com/k.js';   
				var s = document.getElementsByTagName('body')[0];   
				s.parentNode.insertBefore(kdt, s);   
			})();

			
			(function() {     
				var period = 300;     
				var limit = 20 * 1e3;     
				var nTry = 0;     
				var intervalID = setInterval(function() { // loop para retentar o envio         
					var clear = limit/period <= ++nTry;         
					if ((typeof(Konduto) !== "undefined") &&
				 	    (typeof(Konduto.setCustomerID) !== "undefined")) {            
					window.Konduto.setCustomerID(customerID); // envia o ID para a Konduto             
					clear = true;         
				}         
				if (clear) {
			 clearInterval(intervalID); 
			}     
			}, period);
			 })(customerID);


			var page_category = 'teste_konduto_checkout_transparente'; 
			(function() {     
				var period = 300;     
				var limit = 20 * 1e3;     
				var nTry = 0;     
				var intervalID = setInterval(function() {         
					var clear = limit/period <= ++nTry;         
					if ((typeof(Konduto) !== "undefined") &&
					    (typeof(Konduto.sendEvent) !== "undefined")) {             
					Konduto.sendEvent('page', page_category); // Disparo programático de evento             
					clear = true;         
					}         
				if (clear) { 
			clearInterval(intervalID); 
				}     
			}, 
			period); 
})(page_category); 
	</script>
	<script type="text/javascript">



		$("#formId").submit(function(e){
			 e.preventDefault();
			var value_int = parseInt($("#amount").val());
			var value_decimal = parseFloat((value_int / 100).toFixed(2))
			var settings = {
				  "url": "https://gateway-hmg.linx.com.br/v3/sales",
				  "method": "POST",
				  "timeout": 0,
				  "headers": {
			   
				    "Content-Type": "application/json",
				    "Authorization": `Bearer ${$("#authorization").val()}`,
				    "Cookie": `access_token=${$("#authorization").val()}`
				  },
				 "data": JSON.stringify({"merchantOrderId": $("#orderId").val(),"hasRiskAnalysis":true,"transactionType":3,"supplier":"REDE","softDescriptor":"SmartSales","urlNotification":"https://www.linx.com.br","customIdKonduto": customerID ,"payment":{"amount": value_int,"currency":"BRL","method":0,"card":{"holder":"Joao Vitor Paulino","number":"5448280000000007","securityCode":"123","month":"01","year":"2021","brand":"MCI"},"recurring":{"isRecurring":true}},"shoppingCart":{"totalAmount":value_decimal,"shippingAmount":0,"taxAmount":0,"purchasedAt":"2020-07-03 10:23","channel":"web","products":[{"code":"6cc90117-1a8d-4cae-9947-642dfa7e3a6d","description":"Bermuda Alfaiataria Linho Bolso Faca","quantity":1,"price": value_decimal,"sku":"83cda3d6-0d83-4840-9278-e214643f1177","name":"Bermuda Alfaiataria Linho Bolso Faca","discount":0,"unitCost": value_decimal,"createdAt":"0001-01-01 00:00"}]},"seller":{"id":"5133","name":"Linx PayHub","createdAt":"0001-01-01 00:00"},"customer":{"id":"b595cb8c-9868-4b7e-cd0d-08d81efcd68f","name":"Jean Gustavo","birthday":"1994-05-26 00:00","mail":"jeangustavoprates@gmail.com","phone":"+5511977770148","cellPhone":"+5511977770148","createdAt":"0001-01-01 00:00","isVip":false},"addresses":[{"address":"Rua aricanga","city":"São Paulo","country":"BR","zipCode":"08160-000","type":"both"}]})
				};

				$.ajax(settings).done(function (response) {
				  console.log(JSON.stringify(response));
				});
		});

	</script>

</html>